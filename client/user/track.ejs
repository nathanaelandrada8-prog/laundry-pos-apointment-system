<!-- client/content/user/track_order.ejs -->

    <style>
        /* Base Styles (Consistent with other pages) */
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }
        .text-detail-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            color: #6b7280; /* text-gray-500 */
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .text-detail-value {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600;
            color: #1f2937; /* text-gray-800 */
            margin-top: 0.25rem;
        }

        /* Tracking Timeline Styles */
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            padding: 2rem 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #e5e7eb; /* gray-200 */
            transform: translateY(-50%);
            z-index: 10;
        }

        .timeline-step {
            z-index: 20;
            text-align: center;
            width: 20%;
            position: relative;
        }

        .step-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #ffffff;
            background-color: #d1d5db; /* Default gray */
            border: 4px solid #ffffff;
            box-shadow: 0 0 0 2px #d1d5db;
            transition: all 0.3s;
        }

        .step-icon.complete {
            background-color: #10b981; /* green-500 */
            box-shadow: 0 0 0 2px #10b981;
        }

        .step-icon.active {
            background-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px #4f46e5;
            animation: pulse-ring 1.5s infinite;
        }

        .step-label {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* text-gray-500 */
            transition: color 0.3s;
        }
        .step-icon.active + .step-label,
        .step-icon.complete + .step-label {
            color: #1f2937; /* text-gray-800 */
            font-weight: 600;
        }

        /* Animation for active step */
        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Responsive timeline for mobile (vertical layout) */
        @media (max-width: 768px) {
            .timeline {
                flex-direction: column;
                padding: 0 0 0 1.5rem; /* Padding for the line */
                align-items: flex-start;
            }
            .timeline::before {
                width: 4px;
                height: 100%;
                top: 0;
                left: 1.5rem;
                bottom: 0;
                transform: none;
            }
            .timeline-step {
                width: 100%;
                text-align: left;
                margin-bottom: 2rem;
                padding-left: 2rem;
            }
            .step-icon {
                position: absolute;
                left: 0;
                top: 0;
            }
            .step-label {
                margin-left: 1rem;
                display: block;
            }
        }
    </style>

<div class="mx-auto space-y-8">
    
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-4 sm:mb-0">Order Tracking</h1>
        
        <div class="text-right flex flex-col items-end">
            <p class="text-detail-label">Order ID</p>
            <!-- Dynamic Order ID -->
            <p id="orderIdValue" class="text-detail-value text-indigo-600">Loading...</p>
            <!-- EDIT BUTTON -->
            <button id="editOrderBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out mt-3 shadow-md" disabled>
                Edit Order
            </button>
        </div>
    </div>
    
    <!-- Tracking Timeline Card -->
    <div class="card">
        <h2 class="text-2xl font-semibold text-gray-700 mb-6">Current Status: <span id="currentStatusText" class="text-indigo-600">Loading...</span></h2>

        <div class="timeline" id="trackingTimeline">
            <!-- Status keys are mapped to the server-side status field -->
            <div class="timeline-step">
                <div class="step-icon" data-status-key="Pending">1</div>
                <span class="step-label">Scheduled/Pending</span>
            </div>
            
            <div class="timeline-step">
                <div class="step-icon" data-status-key="Picked Up">2</div>
                <span class="step-label">Picked Up</span>
            </div>
            
            <div class="timeline-step">
                <div class="step-icon" data-status-key="In Progress">3</div>
                <span class="step-label">Cleaning in Progress</span>
            </div>

            <div class="timeline-step">
                <div class="step-icon" data-status-key="Ready">4</div>
                <span class="step-label">Ready for Delivery</span>
            </div>
            
            <div class="timeline-step">
                <div class="step-icon" data-status-key="Delivered">5</div>
                <span class="step-label">Completed</span>
            </div>
        </div>
    </div>

    <!-- Order Details Card -->
    <div class="card">
        <h2 class="text-2xl font-semibold text-gray-700 mb-6">Order Details</h2>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-y-6 gap-x-8">
            <!-- Detail 1: Service Type -->
            <div>
                <p class="text-detail-label">Service Type</p>
                <p id="serviceTypeValue" class="text-detail-value">...</p>
            </div>
            
            <!-- Detail 2: Pickup Date -->
            <div>
                <p class="text-detail-label">Pickup Date</p>
                <p id="pickupDateValue" class="text-detail-value">...</p>
            </div>
            
            <!-- Detail 3: Delivery Estimate (Client-side calculated) -->
            <div>
                <p class="text-detail-label">Delivery Estimate</p>
                <p id="deliveryEstimateValue" class="text-detail-value">...</p>
            </div>
            
            <!-- Detail 4: Estimated Quantity/Weight -->
            <div>
                <p class="text-detail-label">Estimated Quantity</p>
                <p id="quantityValue" class="text-detail-value">...</p>
            </div>
            
            <!-- Detail 5: Total Cost -->
            <div>
                <p class="text-detail-label">Total Cost</p>
                <p id="totalCostValue" class="text-detail-value">...</p>
            </div>
            
            <!-- Detail 6: Payment Status -->
            <div>
                <p class="text-detail-label">Payment Status</p>
                <p id="paymentStatusValue" class="text-detail-value text-red-600">...</p>
            </div>
        </div>

        <div class="mt-8 border-t pt-6">
            <p class="text-detail-label">Pickup Address</p>
            <p id="pickupAddressValue" class="text-detail-value">...</p>
        </div>
        
        <div class="mt-4">
            <p class="text-detail-label">Special Instructions</p>
            <p id="instructionsValue" class="text-detail-value italic text-gray-600">...</p>
        </div>
        
        <button class="btn-primary mt-8 self-start" style="padding: 0.5rem 1rem;">
            Contact Support for this Order
        </button>
    </div>

</div>

<!-- Edit Order Modal (Hidden by default) -->
<div id="editOrderModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden transition-opacity duration-300">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-6 sm:p-8 transform scale-100 transition-transform duration-300">
        <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Edit Order <span id="modalOrderId"></span></h3>
        <p class="text-sm text-gray-600 mb-6">You can adjust your order type, pickup details, or special instructions while the order status is 'Pending'.</p>

        <form id="editForm" class="space-y-6">
            <!-- Order Type Change -->
            <div>
                <label class="text-detail-label mb-2 block">Change Fulfillment Method</label>
                <div class="flex space-x-4">
                    <label class="inline-flex items-center p-3 rounded-lg border border-indigo-200 bg-indigo-50 cursor-pointer w-1/2">
                        <input type="radio" name="fulfillmentMethod" id="radioPickup" value="pickup" class="fulfillment-radio form-radio text-indigo-600 w-5 h-5 transition duration-150">
                        <span class="ml-3 font-semibold text-indigo-700">Pickup & Delivery</span>
                    </label>
                    <label class="inline-flex items-center p-3 rounded-lg border border-yellow-200 bg-yellow-50 cursor-pointer w-1/2">
                        <input type="radio" name="fulfillmentMethod" id="radioWalkin" value="walkin" class="fulfillment-radio form-radio text-yellow-600 w-5 h-5 transition duration-150">
                        <span class="ml-3 font-semibold text-yellow-700">Walk-in Dropoff</span>
                    </label>
                </div>
            </div>

            <!-- Pickup Details Container - Conditionally shown -->
            <div id="pickupDetailsContainer" class="space-y-4 border p-4 rounded-lg bg-gray-50 transition-all duration-300">
                <p class="text-sm font-semibold text-indigo-600">Required Pickup Details</p>

                <!-- Pickup Date and Time Slot -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="pickupDate" class="text-detail-label mb-1 block">Date</label>
                        <input type="date" id="pickupDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    </div>
                    <div>
                        <label for="pickupTimeSlot" class="text-detail-label mb-1 block">Time Slot</label>
                        <select id="pickupTimeSlot" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                            <option value="" disabled selected>Select a slot</option>
                            <option value="8AM-11AM">8:00 AM - 11:00 AM</option>
                            <option value="11AM-2PM">11:00 AM - 2:00 PM</option>
                            <option value="2PM-5PM">2:00 PM - 5:00 PM</option>
                        </select>
                    </div>
                </div>

                <!-- Street Address -->
                <div>
                    <label for="streetAddress" class="text-detail-label mb-1 block">Street Address</label>
                    <input type="text" id="streetAddress" placeholder="123 Main St" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                </div>

                <!-- City and Postal Code -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="city" class="text-detail-label mb-1 block">City</label>
                        <input type="text" id="city" placeholder="Manila" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    </div>
                    <div>
                        <label for="postalCode" class="text-detail-label mb-1 block">Postal Code</label>
                        <input type="text" id="postalCode" placeholder="1000" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    </div>
                </div>
            </div>

            <!-- Special Instructions Edit -->
            <div>
                <label for="instructions" class="text-detail-label mb-2 block">Special Instructions</label>
                <textarea id="instructions" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="e.g., Change pickup time to 4 PM, please use non-scented detergent."></textarea>
            </div>
        </form>

        <div class="flex justify-end space-x-3 mt-6">
            <button type="button" id="closeModalBtn" class="btn-secondary">
                Cancel
            </button>
            <button type="button" id="saveChangesBtn" class="btn-primary">
                Save Changes
            </button>
        </div>
    </div>
</div>